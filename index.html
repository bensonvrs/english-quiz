<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­å®¶å…„å¼Ÿæ£’çƒå ´ - AI è‹±èªç‰¹è¨“ç‡Ÿ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce-slow { animation: bounce 2s infinite; }
        .perspective-1000 { perspective: 1000px; }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.5s ease-in-out; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-green-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ç°¡æ˜“åœ–ç¤ºçµ„ä»¶ (SVG)
        const Icons = {
            Volume2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
            Mic: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>,
            Edit3: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Sparkles: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
            Loader: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
        };

        const defaultCards = [
            {
                id: 1,
                player: "Shohei Ohtani",
                team: "Dodgers",
                image: "âš¾ï¸", 
                color: "from-blue-600 to-blue-800",
                sentence: "Ohtani hits a massive home run to win the game.",
                translation: "å¤§è°·ç¿”å¹³æ“Šå‡ºä¸€æ”¯å·¨å¤§çš„å…¨å£˜æ‰“ï¼Œè´å¾—äº†æ¯”è³½ã€‚",
                keywords: ["hits", "massive", "win"],
                grammarFocus: "Subject (Ohtani) + Verb (hits) + Object (home run)"
            },
            {
                id: 2,
                player: "Aaron Judge",
                team: "Yankees",
                image: "ğŸŸï¸",
                color: "from-gray-700 to-gray-900",
                sentence: "The tall player catches the ball near the wall.",
                translation: "é‚£ä½é«˜å¤§çš„çƒå“¡åœ¨ç‰†é‚Šæ¥ä½äº†çƒã€‚",
                keywords: ["tall", "catches", "near"],
                grammarFocus: "Adjective (tall) describes the Noun (player)"
            },
            {
                id: 3,
                player: "Jason & Toby",
                team: "Team Wei",
                image: "ğŸ§¢",
                color: "from-red-600 to-red-800",
                sentence: "We practice baseball every weekend with our father.",
                translation: "æˆ‘å€‘æ¯å€‹é€±æœ«éƒ½è·Ÿçˆ¸çˆ¸ä¸€èµ·ç·´ç¿’æ£’çƒã€‚",
                keywords: ["practice", "weekend", "father"],
                grammarFocus: "Frequency Adverb (every weekend)"
            }
        ];

        const BaseballApp = () => {
            const [cards, setCards] = useState(defaultCards);
            const [currentCardIdx, setCurrentCardIdx] = useState(0);
            const [mode, setMode] = useState('read'); 
            const [score, setScore] = useState(0);
            const [userInput, setUserInput] = useState('');
            const [feedback, setFeedback] = useState(null); 
            const [isListening, setIsListening] = useState(false);
            const [transcript, setTranscript] = useState('');
            const [isLoadingAI, setIsLoadingAI] = useState(false);
            const [aiCoachTip, setAiCoachTip] = useState(null);
            
            const currentCard = cards[currentCardIdx];
            const apiKey = ""; // é€™è£¡é€šå¸¸æ˜¯è‡ªå‹•å¸¶å…¥ï¼Œè‹¥åœ¨ github åŸ·è¡Œéœ€æ³¨æ„ API Key å®‰å…¨ï¼Œæˆ–æ¯æ¬¡æ‰‹å‹•è²¼

            const callGemini = async (prompt, isJson = false) => {
                // å¦‚æœåœ¨ç´”éœæ…‹é é¢æ²’æœ‰å¾Œç«¯ï¼Œéœ€æ³¨æ„ Key çš„æš´éœ²ã€‚
                // ç‚ºäº†æ–¹ä¾¿æ¸¬è©¦ï¼Œé€™è£¡å‡è¨­ç’°å¢ƒæœ‰æ³¨å…¥ï¼Œæˆ–æ‚¨å¯æ‰‹å‹•å¡«å…¥ã€‚
                // å¦‚æœæ²’æœ‰ Keyï¼Œé€™å€‹åŠŸèƒ½æœƒå ±éŒ¯ã€‚
                if(!apiKey) {
                    alert("è«‹å…ˆè¨­å®š API Key æ‰èƒ½ä½¿ç”¨ AI åŠŸèƒ½ï¼");
                    return null;
                }
                
                setIsLoadingAI(true);
                try {
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                generationConfig: isJson ? { responseMimeType: "application/json" } : {}
                            })
                        }
                    );
                    if (!response.ok) throw new Error('API call failed');
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (error) {
                    console.error("Gemini Error:", error);
                    alert("AI çƒæ¢å¿™ç·šä¸­ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
                    return null;
                } finally {
                    setIsLoadingAI(false);
                }
            };

            const handleScoutNewPlayer = async () => {
                const prompt = `
                    You are a baseball English teacher for kids. Generate a NEW, UNIQUE baseball player card data in JSON format.
                    Target Audience: GEPT Elementary level (Kids aged 9-10).
                    Requirements: Famous MLB player, simple sentence, Traditional Chinese translation, 2-3 keywords, simple grammar analogy.
                    Format JSON: {"player":"", "team":"", "image":"Emoji", "color":"Tailwind Gradient", "sentence":"", "translation":"", "keywords":[], "grammarFocus":""}
                `;
                const result = await callGemini(prompt, true);
                if (result) {
                    try {
                        const newCard = { ...JSON.parse(result), id: Date.now() };
                        setCards([...cards, newCard]);
                        setCurrentCardIdx(cards.length);
                        resetState();
                    } catch (e) { console.error(e); alert("è§£æå¤±æ•—"); }
                }
            };

            const handleAskCoach = async () => {
                if (aiCoachTip) return;
                const prompt = `Explain grammar of "${currentCard.sentence}" for 10yo kids using BASEBALL ANALOGY. Short, Traditional Chinese. Start with "âš¾ï¸ æ•™ç·´èªªï¼š"`;
                const result = await callGemini(prompt);
                if (result) setAiCoachTip(result);
            };

            const speakSentence = () => {
                if ('speechSynthesis' in window) {
                    const u = new SpeechSynthesisUtterance(currentCard.sentence);
                    u.lang = 'en-US'; u.rate = 0.9;
                    window.speechSynthesis.speak(u);
                } else alert("ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³");
            };

            const startListening = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) { alert("è«‹ç”¨ Chrome"); return; }
                const recognition = new SpeechRecognition();
                recognition.lang = 'en-US';
                setIsListening(true);
                setTranscript('Listening...');
                setFeedback(null);
                recognition.onresult = (e) => {
                    const text = e.results[e.results.length-1][0].transcript;
                    setTranscript(text);
                    checkSpeaking(text);
                };
                recognition.onend = () => setIsListening(false);
                recognition.start();
            };

            const checkSpeaking = (text) => {
                const clean = (s) => s.toLowerCase().replace(/[.,!]/g, '');
                if (clean(text).includes(clean(currentCard.sentence))) {
                    setFeedback('correct'); setScore(s => s + 20);
                } else {
                    setFeedback('incorrect');
                }
            };

            const checkWriting = () => {
                const clean = (s) => s.toLowerCase();
                const input = clean(userInput);
                const match = currentCard.keywords.every(k => input.includes(clean(k)));
                if (match) { setFeedback('correct'); setScore(s => s + 20); }
                else { setFeedback('incorrect'); }
            };

            const nextCard = () => {
                if (currentCardIdx < cards.length - 1) { setCurrentCardIdx(c => c + 1); resetState(); }
                else alert("è¨“ç·´å®Œæˆï¼è«‹æŒ‰ã€Œæ´¾å‡ºçƒæ¢ã€ç”Ÿæˆæ–°å¡ç‰‡ï¼");
            };

            const resetState = () => {
                setMode('read'); setFeedback(null); setUserInput(''); setTranscript(''); setIsListening(false); setAiCoachTip(null);
            };

            const NavBtn = ({ icon, active, onClick, label }) => (
                <button onClick={onClick} className={`flex flex-col items-center justify-center w-12 h-12 rounded-lg transition-all ${active ? 'bg-blue-600 text-white shadow-md scale-105' : 'text-gray-400 hover:bg-gray-200'}`}>
                    {icon} <span className="text-[10px] font-bold mt-0.5">{label}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-green-800 font-sans text-gray-100 flex flex-col items-center p-4 relative overflow-hidden">
                    <div className="absolute inset-0 opacity-10" style={{ backgroundImage: 'radial-gradient(#ffffff 2px, transparent 2px)', backgroundSize: '30px 30px' }}></div>
                    
                    <div className="w-full max-w-3xl bg-gray-900 border-4 border-gray-700 rounded-xl p-4 mb-6 shadow-2xl z-10 flex justify-between items-center relative">
                        <div className="flex items-center gap-3">
                            <div className="bg-yellow-500 p-2 rounded-lg text-gray-900 font-black">HOME</div>
                            <div className="text-4xl font-mono text-red-500 font-bold tracking-widest">{score.toString().padStart(3, '0')}</div>
                        </div>
                        <div className="text-center">
                            <h1 className="text-lg md:text-2xl font-black text-white tracking-tighter uppercase italic">Wei Bros Stadium</h1>
                            <p className="text-xs text-gray-400">AI-Powered Training Camp</p>
                        </div>
                        <div className="flex items-center gap-2">
                             <span className="text-xs text-gray-400">INNING</span>
                             <span className="text-2xl font-mono text-yellow-400">{currentCardIdx + 1}</span>
                        </div>
                    </div>

                    <div className="w-full max-w-md mb-4 flex justify-end z-20">
                        <button onClick={handleScoutNewPlayer} disabled={isLoadingAI} className="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-full font-bold shadow-lg hover:scale-105 transition disabled:opacity-50">
                            {isLoadingAI ? <Icons.Loader className="animate-spin" /> : <Icons.Sparkles className="text-yellow-300" />}
                            {isLoadingAI ? "Scouting..." : "æ´¾å‡º AI çƒæ¢"}
                        </button>
                    </div>

                    <div className="w-full max-w-md relative z-10 perspective-1000">
                        <div className={`relative bg-gradient-to-br ${currentCard.color} rounded-3xl shadow-2xl border-4 border-white/20 overflow-hidden transition-all duration-500`}>
                            <div className="h-48 flex items-center justify-center bg-black/20 relative">
                                <div className="text-8xl animate-bounce-slow">{currentCard.image}</div>
                                <div className="absolute bottom-2 left-4 text-white font-black text-3xl italic drop-shadow-lg">{currentCard.player}</div>
                                <div className="absolute top-4 right-4 bg-white text-gray-900 text-xs font-bold px-2 py-1 rounded uppercase">{currentCard.team}</div>
                            </div>

                            <div className="p-6 bg-white text-gray-800 min-h-[300px]">
                                {mode === 'read' && (
                                    <div className="animate-fade-in">
                                        <div className="flex items-center gap-2 mb-2 text-blue-600 font-bold uppercase text-sm"><Icons.BookOpen /> Scouting Report</div>
                                        <h2 className="text-2xl font-bold mb-4 leading-relaxed">{currentCard.sentence}</h2>
                                        <p className="text-gray-500 mb-6 border-l-4 border-yellow-400 pl-3 italic">{currentCard.translation}</p>
                                        <div className="bg-gray-100 p-3 rounded-lg text-sm mb-4"><strong className="text-gray-700 block mb-1">âš¾ï¸ Coach's Note:</strong>{currentCard.grammarFocus}</div>
                                        {!aiCoachTip ? (
                                            <button onClick={handleAskCoach} disabled={isLoadingAI} className="w-full flex items-center justify-center gap-2 bg-indigo-100 text-indigo-700 py-2 rounded-lg font-bold hover:bg-indigo-200 transition">
                                                {isLoadingAI ? <Icons.Loader className="animate-spin" /> : <Icons.Sparkles />} æ•™ç·´ï¼Œæˆ‘ä¸æ‡‚é€™å€‹æˆ°è¡“ï¼
                                            </button>
                                        ) : (
                                            <div className="bg-indigo-50 border border-indigo-200 p-3 rounded-lg text-sm text-indigo-800 animate-fade-in">{aiCoachTip}</div>
                                        )}
                                    </div>
                                )}

                                {mode === 'listen' && (
                                    <div className="flex flex-col items-center justify-center h-full animate-fade-in py-8">
                                        <h3 className="text-xl font-bold mb-2">å°ˆå¿ƒè½æ•™ç·´èªªï¼</h3>
                                        <button onClick={speakSentence} className="bg-blue-500 hover:bg-blue-600 text-white p-6 rounded-full shadow-lg transform transition active:scale-95"><Icons.Volume2 /></button>
                                    </div>
                                )}

                                {mode === 'speak' && (
                                    <div className="flex flex-col items-center justify-center h-full animate-fade-in py-4">
                                        <h3 className="text-xl font-bold mb-4">è¼ªåˆ°ä½ æ‰“æ“Šäº†ï¼</h3>
                                        <p className="text-lg font-medium text-center mb-6 bg-gray-50 p-2 rounded text-gray-600">"{currentCard.sentence}"</p>
                                        <button onClick={startListening} disabled={isListening} className={`${isListening ? 'bg-red-500 animate-pulse' : 'bg-green-500 hover:bg-green-600'} text-white p-6 rounded-full shadow-lg mb-4 transition-all`}><Icons.Mic /></button>
                                        <div className="h-8 text-center font-mono text-sm text-gray-500">{isListening ? "Listening..." : transcript}</div>
                                        {feedback === 'correct' && <div className="mt-4 flex items-center text-green-600 font-bold text-xl animate-bounce"><Icons.Check /> HOMERUN!</div>}
                                        {feedback === 'incorrect' && <div className="mt-4 flex items-center text-orange-500 font-bold animate-shake"><Icons.X /> FOUL BALL!</div>}
                                    </div>
                                )}

                                {mode === 'write' && (
                                    <div className="animate-fade-in pt-4">
                                        <h3 className="text-lg font-bold mb-4 flex items-center gap-2"><Icons.Edit3 /> å¡«å¯«é—œéµå­—</h3>
                                        <p className="mb-4 text-lg text-center">
                                            {currentCard.sentence.split(' ').map((word, i) => {
                                                const clean = word.replace(/[.,]/g, '');
                                                const isKey = currentCard.keywords.some(k => clean.toLowerCase().includes(k.toLowerCase()));
                                                return isKey ? <span key={i} className="inline-block w-16 border-b-2 border-black mx-1"></span> : word + ' ';
                                            })}
                                        </p>
                                        <input type="text" value={userInput} onChange={(e) => setUserInput(e.target.value)} placeholder="è¼¸å…¥ç¼ºå°‘çš„å–®å­—" className="w-full border-2 border-gray-300 rounded-lg p-3 text-lg mb-4 focus:border-blue-500 focus:outline-none" />
                                        <button onClick={checkWriting} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition">æ®æ£’</button>
                                        {feedback === 'correct' && <div className="mt-4 text-center text-green-600 font-bold text-xl">NICE PLAY!</div>}
                                    </div>
                                )}
                            </div>

                            <div className="bg-gray-100 p-2 flex justify-between items-center border-t border-gray-200">
                                <div className="flex gap-1">
                                    <NavBtn icon={<Icons.BookOpen />} active={mode==='read'} onClick={() => {setMode('read'); setFeedback(null);}} label="è®€" />
                                    <NavBtn icon={<Icons.Volume2 />} active={mode==='listen'} onClick={() => {setMode('listen'); setFeedback(null);}} label="è½" />
                                    <NavBtn icon={<Icons.Mic />} active={mode==='speak'} onClick={() => {setMode('speak'); setFeedback(null);}} label="èªª" />
                                    <NavBtn icon={<Icons.Edit3 />} active={mode==='write'} onClick={() => {setMode('write'); setFeedback(null);}} label="å¯«" />
                                </div>
                                <button onClick={nextCard} className="flex items-center gap-1 bg-black text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-800 transition">NEXT <Icons.ChevronRight /></button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BaseballApp />);
    </script>
</body>
</html>
